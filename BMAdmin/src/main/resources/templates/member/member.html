<!doctype html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
		<meta name="generator" content="Jekyll v4.1.1">
		<title>BMBoard Admin</title>
		<link href="/admin/css/bootstrap/bootstrap.min.css" rel="stylesheet">
		<!-- Custom styles for this template -->
		<link href="/admin/css/dashboard/dashboard.css" rel="stylesheet">
	</head>
	<body>
		<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
			<a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">BMBoard Admin</a>
			<button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<!-- <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search"> -->
			<ul class="navbar-nav px-3">
				<li class="nav-item text-nowrap">
					<a class="nav-link" href="/admin/logout">Log out</a>
				</li>
			</ul>
		</nav>

		<div class="container container-fluid">
			<div class="row">
				<nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
					<div class="sidebar-sticky pt-3">
						<ul class="nav flex-column">
							<li class="nav-item">
								<a class="nav-link active" href="/admin/member/list.html">
									<span data-feather="users"></span>
									사용자 관리
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/admin/board/list.html">
									<span data-feather="clipboard"></span>
									게시판 관리
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/admin/post/list.html">
									<span data-feather="file-text"></span>
									게시물 관리
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									<span data-feather="trending-up"></span>
									통계 데이터
								</a>
							</li>
						</ul>
					</div>
				</nav>
		
				<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
					<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
						<h1 class="h2">사용자 관리</h1>
						<div class="btn-toolbar mb-2 mb-md-0">
							<div class="btn-group mr-2">
								<button type="button" class="btn btn-sm btn-outline-secondary">
								<span data-feather="download"></span>
								엑셀 다운로드
								</button>
							</div>
							<div class="btn-group mr-2">
								<button type="button" class="btn btn-sm btn-outline-success" id="buttonRegister">
								<span data-feather="plus-square"></span>
								회원 등록
								</button>
							</div>
						</div>
					</div>
					
					<div class="container">
						<div class="row">
							<div class="col-md-12">
								<div class="table-responsive">
									<table id="mytable" class="table table-bordred table-striped table-sm">
										<thead>
											<th>순번</th>
											<th>E-MAIL</th>
											<th>회원이름</th>
											<th>가입일자</th>
											<th>수정일자</th>
											<th>수정</th>
											<th>삭제</th>
										</thead>
										<tbody>
										</tbody>
									</table>
									
									<nav aria-label="Page navigation example">
										<ul id="pagination" class="pagination justify-content-center">
										</ul>
									</nav>
								</div>
							</div>
						</div>
					</div>
				</main>
			</div>
		</div>
		
		<div class="modal fade" id="dialogEdit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>
						<h4 class="modal-title custom_align" id="Heading">회원 정보 수정</h4>
					</div>
					<div class="modal-body">
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanMemberIdx1" style="width:105px;">회원순번</span>
							</div>
							<input type="text" class="form-control bmInput" id="memberIdx1" disabled="true" aria-label="회원순번" aria-describedby="회원순번">
							<div class="input-group-append">
								<button class="btn btn-outline-warning" type="button" id="goInitPassword">비밀번호 초기화</button>
							</div>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanName1" style="width:105px;">회원이름</span>
							</div>
							<input type="text" class="form-control bmInput" id="name1" disabled="true" aria-label="회원이름" aria-describedby="회원이름">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanEmail1" style="width:105px;">회원이메일</span>
							</div>
							<input type="text" class="form-control bmInput" id="email1" disabled="true" aria-label="회원이메일" aria-describedby="회원이메일">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="auth1" style="width:105px;">회원권한</label>
							</div>
							<select class="custom-select bmInput" id="auth1">
								<option value="ROLE_ADMIN">관리자</option>
								<option value="ROLE_MEMBER">회원</option>
								<option value="ROLE_ADMIN, ROLE_MEMBER">관리자, 회원</option>
							</select>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanRanking1" style="width:105px;">회원랭킹</span>
							</div>
							<input type="text" class="form-control bmInput" id="ranking1" disabled="true" aria-label="회원랭킹" aria-describedby="회원랭킹">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanRegDate1" style="width:105px;">가입일자</span>
							</div>
							<input type="text" class="form-control bmInput" id="regDate1" disabled="true" aria-label="가입일자" aria-describedby="가입일자">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanRegAdmin1" style="width:105px;">등록관리자</span>
							</div>
							<input type="text" class="form-control bmInput" id="regAdmin1" disabled="true" aria-label="등록관리자" aria-describedby="등록관리자">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanmMdDate1" style="width:105px;">수정일자</span>
							</div>
							<input type="text" class="form-control bmInput" id="modDate1" disabled="true" aria-label="수정일자" aria-describedby="수정일자">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanModAdmin1" style="width:105px;">수정관리자</span>
							</div>
							<input type="text" class="form-control bmInput" id="modAdmin1" disabled="true" aria-label="수정관리자" aria-describedby="수정관리자">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="memberState1" style="width:105px;">회원상태</label>
							</div>
							<select class="custom-select bmInput" id="memberState1">
								<option value="NORMAL">정상</option>
								<option value="BLOCK">관리자 삭제</option>
								<option value="PWLOCK">비밀번호 3회 이상 불일치</option>
							</select>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanMemberTry1" style="width:105px;">회원횟수</span>
							</div>
							<input type="text" class="form-control bmInput" id="memberTry1" aria-label="회원로그인시도횟수" aria-describedby="회원로그인시도횟수">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="adminState1" style="width:105px;">관리자상태</label>
							</div>
							<select class="custom-select bmInput" id="adminState1">
								<option  value="NORMAL">정상</option>
								<option  value="BLOCK">관리자 삭제</option>
								<option  value="PWLOCK">비밀번호 3회 이상 불일치</option>
							</select>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanAdminTry1" style="width:105px;">관리자횟수</span>
							</div>
							<input type="text" class="form-control bmInput" id="adminTry1" aria-label="관리자로그인시도횟수" aria-describedby="관리자로그인시도횟수" min="0" max="5">
						</div>
					</div>
					<div class="modal-footer ">
						<button type="button" class="btn btn-warning btn-lg" id="goUpdate"style="width: 100%;">
							<span class="glyphicon glyphicon-ok-sign">Update</span>
						</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="dialogRegister" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>
						<h4 class="modal-title custom_align" id="Heading">회원 등록</h4>
					</div>
					<div class="modal-body">
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanName2" style="width:105px;">회원이름</span>
							</div>
							<input type="text" class="form-control bmInput" id="name2" aria-label="회원이름" aria-describedby="회원이름">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text" id="spanEmail2" style="width:105px;">회원이메일</span>
							</div>
							<input type="text" class="form-control bmInput" id="email2" aria-label="회원이메일" aria-describedby="회원이메일">
							<div class="input-group-append">
								<button class="btn btn-outline-warning" type="button" id="goEmailCheck">중복확인</button>
							</div>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="auth2" style="width:105px;">회원권한</label>
							</div>
							<select class="custom-select bmInput" id="auth2">
								<option value="ROLE_ADMIN">관리자</option>
								<option value="ROLE_MEMBER">회원</option>
								<option value="ROLE_ADMIN, ROLE_MEMBER">관리자, 회원</option>
							</select>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="memberState2" style="width:105px;">회원상태</label>
							</div>
							<select class="custom-select bmInput" id="memberState2">
								<option value="NORMAL">정상</option>
								<option value="BLOCK">관리자 삭제</option>
								<option value="PWLOCK">비밀번호 3회 이상 불일치</option>
							</select>
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<label class="input-group-text" for="adminState2" style="width:105px;">관리자상태</label>
							</div>
							<select class="custom-select bmInput" id="adminState2">
								<option value="NORMAL">정상</option>
								<option value="BLOCK">관리자 삭제</option>
								<option value="PWLOCK">비밀번호 3회 이상 불일치</option>
							</select>
						</div>
					</div>
					<div class="modal-footer ">
						<button type="button" class="btn btn-warning btn-lg" id="goRegister"style="width: 100%;">
							<span class="glyphicon glyphicon-ok-sign">Register</span>
						</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="dialogDelete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>
						<h4 class="modal-title custom_align" id="Heading">회원 삭제</h4>
					</div>
					<div class="modal-body">
						<div class="alert alert-danger">
							<span class="glyphicon glyphicon-warning-sign" id="msg">회원을 삭제하시겠습니까?</span>
						</div>
					</div>
					<div class="modal-footer ">
						<input type="hidden" class="bmInput" id="memberIdx3"/>
						<input type="hidden" class="bmInput" id="memberState3"/>
						<input type="hidden" class="bmInput" id="adminState3"/>
						<input type="hidden" class="bmInput" id="divn3"/>
						<button type="button" class="btn btn-danger member" id="goDelete">
							<span class="glyphicon glyphicon-ok-sign">회원만</span>
						</button>
						<button type="button" class="btn btn-danger admin" id="goDelete">
							<span class="glyphicon glyphicon-ok-sign">관리자만</span>
						</button>
						<button type="button" class="btn btn-danger both" id="goDelete">
							<span class="glyphicon glyphicon-ok-sign">둘 다</span>
						</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">
							<span class="glyphicon glyphicon-remove">No</span>
						</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" tabindex="-1" id="dialogAlert" role="dialog" aria-labelledby="edit" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>
						<h4 class="modal-title custom_align" id="Heading">오류 발생</h4>
					</div>
					<div class="modal-body">
						<div class="alert alert-danger">
							<span class="glyphicon glyphicon-warning-sign" id="msg"></span>
						</div>
					</div>
					<div class="modal-footer ">
						<button type="button" class="btn btn-danger" data-dismiss="modal"><span class="glyphicon glyphicon-ok-sign">OK</span></button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" tabindex="-1" id="dialogComplete" role="dialog" aria-labelledby="edit" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>
						<h4 class="modal-title custom_align" id="Heading">정상 처리</h4>
					</div>
					<div class="modal-body">
						<div class="alert alert-success">
							<span class="glyphicon glyphicon-warning-sign" id="msg"></span>
						</div>
					</div>
					<div class="modal-footer ">
						<button type="button" class="btn btn-success" data-dismiss="modal"><span class="glyphicon glyphicon-ok-sign">OK</span></button>
					</div>
				</div>
			</div>
		</div>
		
		<input type="hidden" id="csrf" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	</body>
	<script src="/admin/js/jquery/jquery.min.js"></script>
	<script src="/admin/js/bootstrap/bootstrap.bundle.min.js"></script>
	<script src="/admin/js/dashboard/feather.min.js"></script>
	<script src="/admin/js/jquery/jquery.twbsPagination.js"></script>
	<script>
		$(document).ready(function(){
			var pageSize = 10;
			var pageNum = 1;
			var emailCheck = false;
			/* 모든 회원의 데이터 조회
			   page : 페이지 번호
			   paging : 초기화 여부
			*/
			var getList = function(paging){
   				var data = null;
   				$.ajax({
     			      url:"/admin/members"
     			    , async:true
     			    , type:'POST'
     			    , data: {
     			    	  pageSize:pageSize
     			    	, pageNum:(pageNum - 1)
     			    	, _csrf:$("#csrf").val()
     			    }
     			    , dataType:'json'
     			    , success:function(e) {
     			    	data = e;
     			    	
     			    	viewList(data);
     			    	
     			    	if(paging){
     			    		pagination(data.totalPages);
     			    	}
     			    	console.log(data);
     			    }
     			    , error:function(e) {
     			    	console.log(e);
     			    }
     			});
   			}
			
			/* 회원 데이터 테이블 추가
			   data : 회원 데이터
			*/
			var viewList = function(data){
				$("#mytable tbody").children().remove();
   				
   				var html = "";
   				for(var i = 0; i < data.numberOfElements; i++){
   					
					html += "<tr>";
					html += "<td><span class='d-inline-block text-truncate bmIdx' style='max-width: 30px;' title='" + data.content[i].memberIdx + "'>";
					html += data.content[i].memberIdx + "</span></td>";
					html += "<td><span class='d-inline-block text-truncate' style='max-width: 150px;' title='" + data.content[i].email + "'>";
					html += data.content[i].email + "</span></td>";
					html += "<td><span class='d-inline-block text-truncate' style='max-width: 80px;' title='" + data.content[i].name + "'>";
					html += data.content[i].name + "</span></td>";
					html += "<td>" + data.content[i].regDate.substr(0, 10) + "</td>";
					html += "<td>" + data.content[i].modDate.substr(0, 10) + "</td>";
					html += "<td>";
					html += "<button type='button' id='buttonEdit' class='btn btn-info btn-sm'>";
					html += "<span data-feather='edit'></span>";
					html += "</button>";
					html += "</td>";
					if(data.content[i].adminState == "NORMAL" && data.content[i].memberState == "NORMAL"){
						html += "<td>";
						html += "<button type='button' id='buttonDelete' class='btn btn-danger btn-sm hide'>";
						html += "<span data-feather='trash'></span>";
						html += "</button>";
						html += "</td>";
					}else{
						html += "<td>";
						html += "<button type='button' id='buttonDelete' class='btn btn-warning btn-sm show'>";
						html += "<span data-feather='trash'></span>";
						html += "</button>";
						html += "</td>";
					}
					html += "</tr>";
   				}
   				
   				$("#mytable tbody").html(html);
   				
   				feather.replace();
			};
			
			/* 회원 데이터 페이징
			   totalPages : 회원 데이터 페이징 총 페이지 수
			*/
			var pagination = function(totalPages){
				$('#pagination').twbsPagination({
		            totalPages: totalPages,
		            visiblePages: pageSize,
		            onPageClick: function (event, page) {
		                console.info(page + ' (from options)');
		            }
		        }).on('page', function (event, page) {
		        	pageNum = page;
		        	getList(false);
		            console.info(page + ' (from event listening)');
		        });
			};
			
			/* 테이블의 회원 수정 버튼 클릭 */
			$(document).on("click", "#buttonEdit", function(){
				var _tr = $(this).parent().parent();
				var memberIdx = _tr.find(".bmIdx").text();
				$.ajax({
	   			      url:"/admin/member/" + memberIdx
	   			    , async:true
	   			    , type:'GET'
	   			    , data: {
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
	   			    	console.log(data);
	   			    	if(data.resultVo.code == "0000"){
		 					$("#dialogEdit #memberIdx1").val(data.member.memberIdx);
		 					$("#dialogEdit #name1").val(data.member.name);
		 					$("#dialogEdit #email1").val(data.member.email);
		 					$('#dialogEdit #auth1').find('option[value="' + data.member.auth + '"]').attr("selected",true);
		 					$("#dialogEdit #ranking1").val(data.member.ranking);
		 					$("#dialogEdit #regDate1").val(data.member.regDate.substr(0, 10) + " " + data.member.regDate.substr(11, 8));
		 					$("#dialogEdit #regAdmin1").val(data.member.regAdmin);
		 					$("#dialogEdit #modDate1").val(data.member.modDate.substr(0, 10) + " " + data.member.modDate.substr(11, 8));
		 					$("#dialogEdit #modAdmin1").val(data.member.modAdmin);
		 					$('#dialogEdit #memberState1').find('option[value="' + data.member.memberState + '"]').attr("selected",true);
		 					$('#dialogEdit #adminState1').find('option[value="' + data.member.adminState + '"]').attr("selected",true);
		 					$("#dialogEdit #memberTry1").val(data.member.memberTry);
		 					$("#dialogEdit #adminTry1").val(data.member.adminTry);
	   			    		$('#dialogEdit').modal('show');
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
				    		$('#dialogAlert').modal('show');
	   			    	}
	   			    	
	   			    }
	   			    , error:function(e) {
	   			    	$('#dialogAlert #msg').html("정상적으로 조회되지 않았습니다. 다시 조회해주세요.");
   			    		$('#dialogAlert').modal('show');
	   			    }
	   			});
			});
			
			/* 수정 dialog에 update 버튼 클릭 */
			$('#goUpdate').on('click', function(){
				var _dialog = $("#dialogEdit");
				if(!validCheck(_dialog)){
					return false;
				}
				
				$.ajax({
	   			      url:"/admin/member/" + _dialog.find("#memberIdx1").val()
	   			    , async:true
	   			    , type:'PUT'
	   			    , data: {
	   			    	  auth:$("#dialogEdit #auth1").val()
	   			    	, memberState:_dialog.find("#memberState1").val()
	   			    	, adminState:_dialog.find("#adminState1").val()
	   			    	, memberTry:_dialog.find("#memberTry1").val()
	   			    	, adminTry:_dialog.find("#adminTry1").val()
	   			    	, _csrf:$("#csrf").val()
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
	   			    	if(data.resultVo.code == "0000"){
	   			    		_dialog.modal('hide');
	   			    		$('#dialogComplete #msg').html("수정됐습니다.");
	   			    		$('#dialogComplete').modal('show');
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
				    		$('#dialogAlert').modal('show');
	   			    	}
	   			    }
	   			    , error:function(e) {
	   			    	$('#dialogAlert #msg').html("수정에 실패했습니다. 개발팀에 문의해주세요.");
			    		$('#dialogAlert').modal('show');
	   			    }
				});
			});
			
			/* 수정 dialog에 비밀번호 초기화 버튼 클릭 */
			$('#goInitPassword').on('click', function(){
				var _dialog = $("#dialogEdit");
				$.ajax({
	   			      url:"/admin/member/" + _dialog.find("#memberIdx1").val()
	   			    , async:true
	   			    , type:'POST'
	   			    , data: {
	   			    	_csrf:$("#csrf").val()
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
   			    		if(data.resultVo.code == "0000"){
   			    			_dialog.modal('hide');
   			    			$('#dialogComplete #msg').html("비밀번호 초기화됐습니다.");
   	   			    		$('#dialogComplete').modal('show');
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
				    		$('#dialogAlert').modal('show');
	   			    	}
	   			    }
	   			    , error:function(e) {
	   			    	$('#dialogAlert #msg').html("비밀번호 초기화에 실패했습니다. 개발팀에 문의해주세요.");
			    		$('#dialogAlert').modal('show');
	   			    }
				});
			});
			
			/* 회원 등록 버튼 클릭 */
			$("#buttonRegister").on("click", function(){
				$('#dialogRegister').modal('show');
			});
			
			/* 회원 등록 버튼 onkeyup */
			$("#email2").on("keyup", function(){
				emailCheck = false;
			});
			
			/* 등록 dialog에 이메일 중복체크 버튼 클릭 */
			$('#goEmailCheck').on('click', function(){
				var _dialog = $("#dialogRegister");
				
				$.ajax({
	   			      url:"/admin/member"
	   			    , async:true
	   			    , type:'PUT'
	   			    , data: {
						  email:_dialog.find("#email2").val()
	   			    	, _csrf:$("#csrf").val()
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
	   			    	console.log(data);
	   			    	if(data.resultVo.code == "0000"){
	 			    		$('#dialogComplete #msg').html("등록 가능한 회원이메일입니다.");
	   			    		$('#dialogComplete').modal('show');
		   			    	emailCheck = true;
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
	 			    		$('#dialogAlert').modal('show');
	 			    		emailCheck = false;
	   			    	}
	   			    }
	   			    , error:function(data, msg, response) {
	   			    	console.log("error");
 			    		$('#dialogAlert #msg').html("이메일 중복체크에 실패했습니다. 개발팀에 문의해주세요.");
 			    		$('#dialogAlert').modal('show');
	   			    }
				});
			});
			
			
			/* 등록 dialog에 register 버튼 클릭 */
			$('#goRegister').on('click', function(){
				var _dialog = $("#dialogRegister");
				
				if(!validCheck(_dialog)){
					return false;
				}
				
				$.ajax({
	   			      url:"/admin/member/"
	   			    , async:true
	   			    , type:'POST'
	   			    , data: {
						  name:_dialog.find("#name2").val()
	   			    	, email:_dialog.find("#email2").val()
	   			    	, auth:_dialog.find("#auth2").val()
	   			    	, memberState:_dialog.find("#memberState2").val()
	   			    	, adminState:_dialog.find("#adminState2").val()
	   			    	, _csrf:$("#csrf").val()
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
	   			    	console.log(response);
   			    		if(data.resultVo.code == "0000"){
   			    			_dialog.modal('hide');
   			    			$('#dialogComplete #msg').html("등록됐습니다.");
   	   			    		$('#dialogComplete').modal('show');
   	   			    		pageNum = 1;
   	   			    		getList(true);
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
	 			    		$('#dialogAlert').modal('show');
	   			    	}
	   			    }
	   			    , error:function(data, msg, response) {
	   			    	console.log(response);
   			    		$('#dialogAlert #msg').html("등록에 실패했습니다. 개발팀에 문의해주세요.");
   			    		$('#dialogAlert').modal('show');
	   			    }
				});
			});
			
			/* 저장 시 값 유효성 체크
			   _dialog : 체크할 dialog의 jquery object
			*/
			var validCheck = function(_dialog){
				if(_dialog.attr("id") == "dialogEdit"){
					if(!$.isNumeric(_dialog.find("#memberTry1").val())){
						$('#dialogAlert #msg').html("회원 로그인 시도 횟수는 숫자로 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if((_dialog.find("#memberTry1").val() * 1) > 5 || (_dialog.find("#memberTry1").val() * 1) < 0){
						$('#dialogAlert #msg').html("회원 로그인 시도 횟수는 0~5 사이값으로 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(!$.isNumeric(_dialog.find("#adminTry1").val())){
						$('#dialogAlert #msg').html("관리자 로그인 시도 횟수는 숫자로 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if((_dialog.find("#adminTry1").val() * 1) > 5 || (_dialog.find("#adminTry1").val() * 1) < 0){
						$('#dialogAlert #msg').html("관리자 로그인 시도 횟수는 0~5 사이값으로 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}
				}
				
				if(_dialog.attr("id") == "dialogRegister"){
					var regExp = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
					if(_dialog.find("#name2").val() == ""){
						$('#dialogAlert #msg').html(_dialog.find("#name2").attr("aria-label") + "을 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(_dialog.find("#email2").val() == ""){
						$('#dialogAlert #msg').html(_dialog.find("#email2").attr("aria-label") + "을 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(!regExp.test(_dialog.find("#email2").val())){
						$('#dialogAlert #msg').html(_dialog.find("#email2").attr("aria-label") + "의 형식이 맞지 않습니다.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(!emailCheck){
						$('#dialogAlert #msg').html("정상적으로 회원이메일 중복체크를 완료해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(_dialog.find("#auth2").val() == ""){
						$('#dialogAlert #msg').html(_dialog.find("#auth2").attr("aria-label") + "을 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(_dialog.find("#memberState2").val() == ""){
						$('#dialogAlert #msg').html(_dialog.find("#memberState2").attr("aria-label") + "을 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}else if(_dialog.find("#adminState2").val() == ""){
						$('#dialogAlert #msg').html(_dialog.find("#adminState2").attr("aria-label") + "을 입력해주세요.");
			    		$('#dialogAlert').modal('show');
			    		return false;
					}
				}
				
				return true;
			};
			
			/* 테이블의 회원 삭제 버튼 클릭
			*/
			$(document).on("click", "#buttonDelete", function(){
				var _tr = $(this).parent().parent();
				var memberIdx = _tr.find(".bmIdx").text();
				
				$('#memberIdx3').val(memberIdx);
				
				if($(this).hasClass("show")){
					$('#dialogDelete #msg').html("회원을 복원하시겠습니까?");
					$('#dialogDelete #divn3').val("show");
				}else if($(this).hasClass("hide")){
					$('#dialogDelete #msg').html("회원을 삭제하시겠습니까?");
					$('#dialogDelete #divn3').val("hide");
				}
				
				$('#dialogDelete').modal('show');
			});
			
			/* 삭제 dialog에 yes 버튼 클릭 */
			$(document).on('click', '#goDelete', function(){
				var _dialog = $("#dialogDelete");
				
				if(_dialog.find('#divn3').val() == "show"){
					if($(this).hasClass("member")){
						_dialog.find('#memberState3').val("NORMAL");
						_dialog.find('#adminState3').val("BLOCK");
					}else if($(this).hasClass("admin")){
						_dialog.find('#memberState3').val("BLOCK");
						_dialog.find('#adminState3').val("NORMAL");
					}else if($(this).hasClass("both")){
						_dialog.find('#memberState3').val("NORMAL");
						_dialog.find('#adminState3').val("NORMAL");
					}
				}else if(_dialog.find('#divn3').val() == "hide"){
					if($(this).hasClass("member")){
						_dialog.find('#memberState3').val("BLOCK");
						_dialog.find('#adminState3').val("NORMAL");
					}else if($(this).hasClass("admin")){
						_dialog.find('#memberState3').val("NORMAL");
						_dialog.find('#adminState3').val("BLOCK");
					}else if($(this).hasClass("both")){
						_dialog.find('#memberState3').val("BLOCK");
						_dialog.find('#adminState3').val("BLOCK");
					}
				}
				
				$.ajax({
	   			      url:"/admin/member/" + _dialog.find("#memberIdx3").val()
	   			    , async:true
	   			    , type:'DELETE'
	   			    , data: {
	   			    	  _csrf:$("#csrf").val()
	   			    	, memberState:_dialog.find('#memberState3').val()
	   			    	, adminState:_dialog.find('#adminState3').val()
	   			    }
	   			    , dataType:'json'
	   			    , success:function(data, msg, response) {
   			    		if(data.resultVo.code == "0000"){
   			    			_dialog.modal('hide');
   			    			if(_dialog.find('#divn3').val() == "show"){
   			    				$('#dialogComplete #msg').html("복원됐습니다.");
	   	   			    		$('#dialogComplete').modal('show');
   			    			}else if(_dialog.find('#divn3').val() == "hide"){
	   			    			$('#dialogComplete #msg').html("삭제됐습니다.");
	   	   			    		$('#dialogComplete').modal('show');
   			    			}
   	   			    		getList(true);
	   			    	}else{
	   			    		$('#dialogAlert #msg').html(data.resultVo.msg);
	 			    		$('#dialogAlert').modal('show');
	   			    	}
	   			    }
	   			    , error:function(e) {
	   			    	$('#dialogAlert #msg').html("삭제에 실패했습니다. 개발팀에 문의해주세요.");
			    		$('#dialogAlert').modal('show');
	   			    }
				});
			});
			
			// 최초 1페이지 로딩
			getList(true);
		});
	</script>
</html>